<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<project default="finalize_dist" name="Build JavaSim">
	<property name="version" value="1.1.1"/>
	<target name="clean">
		<delete dir="../dist" />
		<delete dir="osx/src"/>
	</target>
	<target name="create_jar" depends="clean">
		<mkdir dir="../bin"/>
		<javac source="1.7" target="1.7" srcdir="../src" destdir="../bin" includeantruntime="false" fork="true">
			<compilerarg line="-XDignore.symbol.file"/><!-- Compiling with rt.jar, http://stackoverflow.com/questions/4065401/using-internal-sun-classes-with-javac -->
		</javac>
		<jar destfile="../dist/JavaSim.jar" manifest="MANIFEST.MF" filesetmanifest="mergewithoutmain">
			<fileset dir="../bin"/>
		</jar>
	</target>
	<target name="create_source_jar" depends="clean">
		<property name="jdk" location="/Library/Java/JavaVirtualMachines/jdk1.7.0_80.jdk"/>
		<path id="master-classpath">
		  <fileset dir="${jdk}/Contents/Home/jre/lib">
		    <include name="*.jar"/>
		  </fileset>
		</path>
		<mkdir dir="../bin"/>
		<javac srcdir="../src" destdir="../bin" includeantruntime="false">
			<classpath refid="master-classpath"/>
		</javac>
		<jar destfile="../dist/JavaSim-${version}-src.jar" manifest="MANIFEST.MF" filesetmanifest="mergewithoutmain">
			<fileset dir="../bin"/>
			<fileset dir="../src"/>
		</jar>
	</target>
	<target name="build_app" depends="create_jar">
		<taskdef name="jarbundler" classname="net.sourceforge.jarbundler.JarBundler"/>
			<jarbundler
				dir="../dist"
			    name="JavaSim"
			    shortname="JavaSim"
			    icon="osx/icons.icns"
			    stubfile="osx/universalJavaApplicationStub"
				mainclass="com.marklalor.javasim.JavaSim"
				jvmversion="1.7+"
				version="${version}"
				jar="../dist/JavaSim.jar"
				copyright="JavaSim ${version}, © 2015–2016 Mark Lalor."
				hiResCapable="true">
			</jarbundler>
		<exec executable="open">
			<arg value="../dist"/>
		</exec>
	</target>
	<target name = "build_dmg" depends="build_app">
		<exec executable="/bin/sh">
			<arg value="osx/build_dmg"/>
			<arg value="${version}"/>
		</exec>
	</target>
	<target name = "finalize_dist" depends="build_dmg">
		<move file = "../dist/JavaSim.jar" tofile="../dist/JavaSim-${version}.jar" />
	</target>
</project>
